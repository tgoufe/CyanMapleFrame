!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=314)}({1:function(e,t,n){"use strict";var r=n(2),i=n(3);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a={eventType:"modelChange"},c={},s={},l=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._value=Object.create(null),this._history=Object.create(null),this._syncList=[],this.config=Object(i.a)(n,e._CONFIG),this._listener=Object(r.b)(this,this.config.eventType,function(e,n,r){t._sync(n,r)})}var t,n,l;return t=e,n=[{key:"_stringify",value:function(e){return null==e&&(e=""),"object"===o(e)?JSON.stringify(e):e.toString()}},{key:"_lastData",value:function(e){var t=this._history[e];return t||(t=this._history[e]=[null]),t[t.length-1]}},{key:"_trackData",value:function(e,t){var n=this._lastData(e);t!==n&&(this._history[e].push(t),console.log("设置",e,"的值为",t),this._trigger(e,t,n))}},{key:"_trigger",value:function(e,t,n){this._listener.trigger(e,t,n)}},{key:"_sync",value:function(e,t){this._syncList.length&&Promise.all(this._syncList.map(function(n){var r;return(r=null!==t?n.setData(e,t):n.removeData(e)).catch(function(e){console.log(e,n.constructor.name,"同步失败")}),r})).then(function(){console.log("同步完成")})}},{key:"_setByObject",value:function(e){var t=this;return Promise.all(Object.keys(e).map(function(n){return t.setData(n,e[n])})).then(function(e){return!!e})}},{key:"_getByArray",value:function(e){var t=this;return Promise.all(e.map(function(e){return t.getData(e).catch(function(){return null})})).then(function(t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})})}},{key:"_removeByArray",value:function(e){var t=this;return Promise.all(e.map(function(e){return t.removeData(e)})).then(function(e){return!!e})}},{key:"setData",value:function(e,t){var n,r=this;return"object"===o(e)?n=this._setByObject(e):(e in this._value?this._value[e]=t:(Object.defineProperty(this._value,e,{enumerable:!0,configurable:!0,set:function(t){r._trackData(e,t)},get:function(){return r._lastData(e)}}),this._trackData(e,t)),n=Promise.resolve(!0)),n}},{key:"getData",value:function(e){var t=arguments.length;return Array.isArray(e)?this._getByArray(e):t>1?this._getByArray([].slice.call(arguments)):e in this._value?Promise.resolve(this._value[e]):Promise.reject(null)}},{key:"removeData",value:function(e){var t,n=arguments.length;if(Array.isArray(e))t=this._removeByArray(e);else if(n>1)t=this._removeByArray([].slice.call(arguments));else try{this._value=null,t=Promise.resolve(!0)}catch(e){t=Promise.reject(e)}return t}},{key:"clearData",value:function(){var e=this;return Object.keys(this._value).forEach(function(t){null!==e._lastData(t)&&e._history[t].push(null)}),this._value={},Promise.resolve(!0)}},{key:"on",value:function(e){return this._listener.add(e),this}},{key:"off",value:function(e){return this._listener.off(e),this}},{key:"syncTo",value:function(t){var n=this;return Array.isArray(t)||(t=[t]),t.forEach(function(t){"object"===o(t)&&t instanceof e&&t!==n&&-1===n._syncList.indexOf(t)?n._syncList.push(t):console.log("该实例类型已经存在")}),this}},{key:"cleanSync",value:function(e){var t=this._syncList.indexOf(e);return-1!==t&&this._syncList.splice(t,1),this}},{key:"toString",value:function(){return JSON.stringify(this._value)}},{key:"toJSON",value:function(){return this._value}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=Object.keys(this._value),n=0,r=t.length;case 2:if(!(n<r)){e.next=8;break}return e.next=5,{topic:t[n],value:this._value[t[n]]};case 5:n++,e.next=2;break;case 8:case"end":return e.stop()}},e,this)})},{key:Symbol.asyncIterator,value:regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=Object.keys(this._value),n=0,r=t.length;case 2:if(!(n<r)){e.next=8;break}return e.next=5,Promise.resolve({topic:t[n],value:this._value[t[n]]});case 5:n++,e.next=2;break;case 8:case"end":return e.stop()}},e,this)})},{key:Symbol.toStringTag,get:function(){return"Model"}}],l=[{key:"register",value:function(t,n){t in e&&t in e._MODEL_CACHE?console.log("type"," 重复注册，并已生成实例，不能覆盖"):e[t]=n}},{key:"registerAlias",value:function(t,n){Array.isArray(n)||(n=[n]),n.forEach(function(n){n in e._MODEL_ALIAS?console.log(n," 已经存在"):e._MODEL_ALIAS[n]=t})}},{key:"factory",value:function(t){var n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t?("object"===o(r)&&(i=r,r=!0),!(t in e)&&t in e._MODEL_ALIAS&&(t=e._MODEL_ALIAS[t]),t in e?!r&&t in e._MODEL_CACHE?(n=e._MODEL_CACHE[t],console.log("从缓存中取到",t,"类型的对象")):(n=new e[t](i),r||(e._MODEL_CACHE[t]=n,console.log("通过工厂方法生成",t,"类型的对象","将",t,"类型的对象缓存"))):(n=new e,console.log("不存在注册为 ",t," 的子类"))):(n=new e,console.log("生成 model 对象")),n}},{key:"_CONFIG",get:function(){return a}},{key:"_MODEL_CACHE",get:function(){return c}},{key:"_MODEL_ALIAS",get:function(){return s}}],n&&u(t.prototype,n),l&&u(t,l),e}();t.a=l},2:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return s});var r=n(3),i=n(20);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a={type:"",target:self||null,capture:!0,passsive:!1,once:!1},c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t.type)throw console.log("未指定监听事件"),new Error("未指定监听事件");this._config=Object(r.a)(t,e._CONFIG),this._isListening=!1,this._listener=null,this._eventQueue=new i.a}var t,n,o;return t=e,o=[{key:"_CONFIG",get:function(){return a}}],(n=[{key:"_queueExecute",value:function(){var e=this._eventQueue;return function(){var t=this||null;return e.fireLineWith(t,Array.from(arguments))}}},{key:"add",value:function(e){return this._isListening||this.on(),this._eventQueue.has(e)?console.log("该函数已经存在于队列中"):this._eventQueue.add(e),this}},{key:"on",value:function(){return this._isListening?this:this._config.target?(this._listener=this._queueExecute(),"addEventListener"in this._config.target&&this._config.target.addEventListener(this._config.type,this._listener,this._config),this._isListening=!0,this):this}},{key:"off",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._config.target?("boolean"==typeof e&&e?("removeEventListener"in this._config.target&&this._config.target.removeEventListener(this._config.type,this._listener,this._config),this._isListening=!1):"function"==typeof e&&this._eventQueue.remove(e),this):this}},{key:"trigger",value:function(){for(var e=this._config.target,t={type:this._config.type,target:this._config.target},n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r.unshift(t),this._listener.apply(e,r),this._config.once&&this.off()}}])&&u(t.prototype,n),o&&u(t,o),e}(),s=function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={};return"object"===o(i)&&(u=i,i=null),"function"==typeof t&&(i=t,t=null),"string"==typeof e&&(t=e,e=null),t&&(a.type=t),e&&(a.target=e),a=Object(r.a)(a,u),n=new c(a),i&&(n.on(),n.add(i)),n}},20:function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._queue=[],this._currIndex=0}var t,n,o;return t=e,(n=[{key:"add",value:function(e){return"function"==typeof e?this._queue.push(e):-1}},{key:"has",value:function(e){return-1!==this._queue.indexOf(e)}},{key:"remove",value:function(e){if("function"==typeof e)e=this._queue.indexOf(e);else{if("number"!=typeof e)return;e=parseInt(e)}e>-1&&(this._queue[e]=null)}},{key:"empty",value:function(){this._queue=[],this._currIndex=0}},{key:"remain",value:function(){return this._currIndex<this._queue.length}},{key:"next",value:function(){var e=null,t=this._currIndex,n=this._queue.length;if(n){for(;t<n&&null===(e=this._queue[t]);t++);t!==n&&(this._currIndex=t+1)}return e}},{key:"reset",value:function(){this._currIndex=0}},{key:"fire",value:function(){return this.next().apply(void 0,arguments)}},{key:"fireWith",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(t)||(t=[t]),this.next().apply(e,t)}},{key:"fireAll",value:function(){var e=arguments;return this.reset(),this._queue.reduce(function(t,n){return null!==n&&t.push(n.apply(void 0,r(e))),t},[])}},{key:"fireAllWith",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.reset(),Array.isArray(t)||(t=[t]),this._queue.reduce(function(n,r){return null!==r&&n.push(r.apply(e,t)),n},[])}},{key:"fireLine",value:function(){var e=arguments;return this.reset(),!this._queue.some(function(t){return null!==t&&!1===t.apply(void 0,r(e))})}},{key:"fireLineWith",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.reset(),Array.isArray(t)||(t=[t]),!this._queue.some(function(n){return null!==n&&!1===n.apply(e,t)})}},{key:"fireReduce",value:function(e){return this.reset(),this._queue.reduce(function(e,t){return null!==t?e.then(function(e){return t(e)}):e},Promise.resolve(e))}},{key:"fireReduceWith",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return this.reset(),this._queue.reduce(function(t,n){return null!==n?t.then(function(t){return n.call(e,t)}):t},Promise.resolve(t))}}])&&i(t.prototype,n),o&&i(t,o),e}();t.a=o},3:function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){r(e,t,n[t])})}return e}({},t,e)}},314:function(e,t,n){e.exports=n(318)},318:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n(3);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l={cacheName:"storage"},f=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=a(this,c(t).call(this,n)))._config=Object(i.a)(n,t._CONFIG),"caches"in self?e._store=Promise.resolve(self.caches):e._store=Promise.reject(new Error("此浏览器不支持 Service Worker")),e}var n,f,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,r["a"]),n=t,h=[{key:"_CONFIG",get:function(){return l}}],(f=[{key:"_tranToRequest",value:function(e){return"object"===o(e)&&e instanceof Request||(e=new Request(e)),e}},{key:"setData",value:function(e,t){var n=this;return this._store.then(function(e){return e.open(n._config.cacheName)}).then(function(r){return console.log("缓存 "+("string"==typeof e?e:e.url)),r.put(n._tranToRequest(e),t)})}},{key:"getData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=this._tranToRequest(e),this._store.then(function(n){return n.match(e,t)}).then(function(t){return t||Promise.reject(new Error("不存在缓存 "+e.url))})}},{key:"removeData",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=this._tranToRequest(e),this._store.then(function(e){return e.open(t._config.cacheName)}).then(function(t){return t.delete(e,n)})}},{key:"clearData",value:function(){var e=this;this._store.then(function(t){return t.delete(e._config.cacheName)})}},{key:"addData",value:function(e){var t=this;return this._store.then(function(e){return e.open(t._config.cacheName)}).then(function(t){return t.add(e)})}},{key:"addAll",value:function(e){var t=this;return this._store.then(function(e){return e.open(t._config.cacheName)}).then(function(t){return t.addAll(e)})}},{key:"keys",value:function(){return this._store.then(function(e){return e.keys()})}},{key:"cacheDelete",value:function(e){return this._store.then(function(t){return t.delete(e)})}},{key:"catch",value:function(e){"function"==typeof e&&this._store.catch(e)}}])&&u(n.prototype,f),h&&u(n,h),t}();r.a.register("cacheStorage",f),r.a.registerAlias("cacheStorage","cs");var h=f;function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cacheStorage",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=new h({cacheName:e});console.log("Service Worker 已加载"),self.addEventListener("install",function(e){console.log("Service Worker 安装完成，install event",e);var n=new Promise(function(e,n){Array.isArray(t)&&t.length?e(t):n()});e.waitUntil(n.then(function(e){return console.log("预加载",e),r.addAll(e)},function(){console.log("没有预加载文件")}).then(function(){return self.skipWaiting()}).catch(function(e){console.log(e)}))}),self.addEventListener("activate",function(t){console.log("新版本 Service Worker 激活 Active event,",t),t.waitUntil(Promise.all([r.keys(),e]).then(function(e){var t=y(e,2),n=t[0],i=t[1];return Promise.all(n.reduce(function(e,t){return i!==t&&e.push(r.cacheDelete(t)),e},[]))}).then(function(){return self.clients.claim()}))}),self.addEventListener("fetch",function(e){var t=e.request;-1===t.url.search(location.host)&&(t=new Request(t.url,{mode:"cors"})),e.respondWith(r.getData(t.clone()).then(function(e){return e||Promise.reject({message:"不存在 "+t.url+" 的相关缓存"})}).catch(function(i){return console.log(i&&i.message),fetch(t).then(function(i){var o=!1;if(i&&200===i.status&&"basic"===i.type)"GET"===t.method&&(o=!0);else if(i.status>200&&i.status,console.log("不缓存",t.url,"status: ",i.status,"type: ",i.type),n&&Array.isArray(n)&&n.length){var u=n.findIndex(function(t){return"string"==typeof t.ext?e.request.endsWith("."+t.ext):Array.isArray(t.ext)?t.ext.some(function(t){return e.request.endsWith("."+t)}):t.ext instanceof RegExp&&t.ext.test(e.request.url)}),a=null;-1!==u&&(a=n[u].handler(t,i)),a instanceof Response&&(i=a)}return o&&r.setData(t,i.clone()).then(function(){console.log("已缓存 "+t.url)}),i})}))}),self.addEventListener("message",function(e){self.clients.matchAll().then(function(t){t.forEach(function(t){t.postMessage(e.data)})})}),self.addEventListener("push",function(e){var t,n;if(e.data){try{(t=e.data.json()).body=t.body||t.message||t.value,n=t.tag=t.tag||Date.now()}catch(r){n=Date.now(),t={title:"Push",body:e.data.text(),tag:n}}e.waitUntil(self.registration.showNotification(t.title,t))}}),self.addEventListener("pushsubscriptionchange",function(e){}),self.addEventListener("sync",function(e){console.log(e.tag,e.lastChance)}),self.addEventListener("notificationclick",function(e){e.notification.close(),console.log("桌面通知被点击"),e.notification.data&&e.waitUntil(self.clients.openWindow(e.notification.data))}),self.addEventListener("notificationclose",function(e){console.log("桌面通知被关闭")})}}})});
//# sourceMappingURL=serviceWork.js.map